// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model LoreBlockUpdate {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  upToBlockNumber Int      @unique
  timeTaken       Int
}

model Token {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tokenContract String
  tokenId       Int
  lore          Lore[]
  wizard        Wizard?
  soul          Soul?    @relation("token")
  transmutedTo  Soul?    @relation("transmutedFromToken")

  @@unique([tokenContract, tokenId])
}

model LoreImage {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  href      String
  lore      Lore     @relation(fields: [loreId], references: [id], onDelete: Cascade)
  loreId    String   @db.Uuid

  @@unique([loreId, href])
}

model Lore {
  id              String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  rawContent      Json?
  backgroundColor String?
  markdownText    String?
  previewText     String?
  token           Token       @relation(fields: [tokenId], references: [id], onDelete: Cascade)
  tokenId         String      @db.Uuid
  index           Int
  creator         String
  parentLoreIndex Int
  loreMetadataURI String?
  txHash          String      @unique
  createdAtBlock  BigInt
  nsfw            Boolean
  struck          Boolean
  discordNotified Boolean     @default(false)
  twitterNotified Boolean     @default(false)
  loreImages      LoreImage[]
}

model LoreContract {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tokenContract String   @unique
  slug          String   @unique
  order         Int      @unique
}

model Wizard {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  token           Token    @relation(fields: [tokenId], references: [id], onDelete: Cascade)
  tokenId         String   @unique @db.Uuid
  name            String?
  image           String?
  background      String?
  backgroundColor String?
  body            String?
  head            String?
  prop            String?
  familiar        String?
  rune            String?
  isBurnt         Boolean  @default(false)

}

model Soul {
  id                    String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  token                 Token    @relation("token", fields: [tokenId], references: [id], onDelete: Cascade)
  tokenId               String   @unique @db.Uuid
  transmutedFromToken   Token    @relation("transmutedFromToken", fields: [transmutedFromTokenId], references: [id], onDelete: Cascade)
  transmutedFromTokenId String   @unique @db.Uuid
  name                  String?
  image                 String?
  background            String?
  backgroundColor       String?
  body                  String?
  head                  String?
  prop                  String?
  familiar              String?
  rune                  String?
  burnIndex             Int

}

model SoulsBlockUpdate {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  upToBlockNumber Int      @unique
  timeTaken       Int

}
